import{M as B,p as F}from"./entry.0a92484f.js";import{q as k}from"./query.16828b1f.js";const D={};console.log("STARTING THE STORE");const q=async()=>{};q();const L=B("rootStore",{state:()=>({scrolled:window.scrollY>0,loading:!0,resetFilters:!1,...D}),actions:{save(s){try{return $,this[s].source==="md"&&githubApi.save(this[s].form),this[s].source,!0}catch(t){console.log(`error while saving ${s}`,t)}},setLogo(s){this.logo=s},setLoading(s){this.loading=s},setScrolled(){this.scrolled=window.scrollY>0},getKey({key:s,level:t,store:e}){console.log("key: ",s),console.log("level: ",t),console.log("store: ",e),console.log("store key val: ",e==null?void 0:e[t[0]]);const i=typeof t[0]=="number";if(t.length===1)return e[t[0]]===void 0&&(e[t[0]]=""),i?e.at(t[0]):e[t[0]];if(t.length>1)return e[t[0]]===void 0&&(i?e[t[0]]=[]:e[t[0]]={}),this.getKey({key:s,level:t.slice(1),store:i?e.at(t[0]):e[t[0]]})},updateForm({key:s,value:t,category:e,level:i=null,store:o=null}){var r;if(i=i??[this[e].form[s]],o=o??this[e].form,console.log(`updateForm 
      key: ${s}
      value: ${t} 
      category: ${e} 
      level: ${i}
      store: ${Array.isArray(o)?o.length:Object.keys(o)}`),i.length===1&&(o[i[0]]===void 0&&(o[i[0]]=""),o[i[0]]=t),i.length>1){const h=typeof i[0]=="number";return o[i[0]]===void 0&&(h?o[i[0]]=[(r=this[e].schema[s])==null?void 0:r.default]:o[i[0]]={}),this.updateForm({key:s,value:t,level:i.slice(1),category:e,store:o[i[0]]})}},deleteFormItem({key:s,category:t,level:e=null,store:i=null}){if(e=e??[this[t].form[s]],i=i??this[t].form,console.log(`deleteFormItem 
      key: ${s}
      category: ${t} 
      level: ${e}`),e.length===1)console.log("store: ",i.length),i=i.filter((r,h)=>h===e[0]),console.log("store: ",i.length);else if(e.length>1)return e[0],this.deleteFormItem({key:s,level:e.slice(1),category:t,store:i[e[0]]})},addFormItem({key:s,category:t,level:e=null,store:i=null,defaults:o=null}){try{if(e=e??[this[t].form[s]],i=i??this[t].form,o||(o=JSON.parse(this[t]._defaults)),console.log("defaults: ",o),console.log(`addFormItem 
        key: ${s}
        category: ${t} 
        level: ${e}`),e.length===1){const r=o[e[0]][0];console.log("defautlValue: ",r),i[s].push(r)}else if(e.length>1){const r=typeof e[0]=="number";return i[e[0]]===void 0&&(r?i[e[0]]=[]:i[e[0]]={}),this.addFormItem({key:s,level:e.slice(1),category:t,store:i[e[0]],defaults:o[e[0]]})}}catch(r){console.log("error: ",r)}},loadRouteQuery(s){const{currentRoute:t}=F(),e=t.value.query;if(e.search&&(this[s].search=e.search),e.filters){const o=JSON.parse(e.filters);Object.keys(o).forEach(r=>{this[s].filters[r]=o[r]})}e.view&&(this[s].view=e.view),e.page?this[s].page=+e.page:this[s].page=1;const i=[this[s].sort[Object.keys(this[s].sort).find(o=>this[s].sort[o].default===!0)]];e.sortBy&&(this[s].sortBy=[e.sortBy]),typeof e.sortDesc<"u"?this[s].sortDesc=e.sortDesc==="true":this[s].sortDesc=i[0].value[1]==="desc"},setSearch({search:s,type:t}){this[t].search=s},setItems({type:s,...t}){this[s].items=t.items,this[s].total=t.total,this[s].numberOfPages=t.numberOfPages},setItemsPerPage({value:s,type:t}){this[t].itemsPerPage=s},setPage({page:s,type:t}){this[t].page=s},setFilters({filters:s,type:t}){s[Object.keys(s)[0]].length&&this[t].loading.push(Object.keys(s)[0]),this[t].filters[Object.keys(s)[0]]=s[Object.keys(s)[0]]},setSort({value:s,type:t}){this[t].sortBy=[s[0]],this[t].sortDesc=s[1]==="-1"},setView({value:s,type:t}){this[t].view=s},setFiltersCount(s){const t=this[s].filters,e=Object.keys(t).filter(i=>typeof t[i]=="boolean"&&t[i]!==null&&t[i]!==void 0||Array.isArray(t[i])&&t[i].length||typeof t[i]=="object"&&Object.keys(t[i]).length).length;this[s].filtersCount=e},setBlankState(s){this.resetFilters=!0;const t=this[s].views[Object.keys(this[s].views).find(i=>this[s].views[i].default===!0)],e=[this[s].sort[Object.keys(this[s].sort).find(i=>this[s].sort[i].default===!0)]];this[s].filters={years:[],issue:[],tags:[],language:[],thematic:[],discipline:[],type:[]},this[s].search="",this[s].view=t.value,this[s].sortBy=e[0].value[0],this[s].sortDesc=e[0].value[1]==="desc",this[s].resetFilters=!1},setBlankFilterLoad(s){this[s].loading=[]},setStyle(s){this.articles.style=s},resetState(s){this.setBlankState(s),this.setPage({page:1,type:s}),this.update(s)},updateSort({value:s,type:t}){this.setSort({value:s,type:t}),this.setPage({page:1,type:t}),this.update(t)},updateView({value:s,type:t}){this.setView({value:s,type:t}),this.update(t)},updateFilters({filters:s,type:t}){this.setFilters({filters:s,type:t}),this.setPage({page:1,type:t}),this.update(t)},updateItemsPerPage({value:s,type:t}){this.setPage({page:1,type:t}),this.setItemsPerPage({value:s,type:t}),this.update(t)},updatePage({page:s,type:t}){this.setPage({page:s,type:t}),this.update(t)},updateSearch({search:s,type:t}){this.setPage({page:1,type:t}),this.setSearch({search:s,type:t}),this.update(t)},async update(s,t,e="md"){var P,S;console.log("type: ",s+"/"+t);const i=s+"/"+t;this.setLoading(!0),F();const o=this[s].filters,r={...o},h={};r.$or=[];for(const n in o){if(!(typeof o[n]=="boolean"&&o[n]!==null&&o[n]!==void 0||Array.isArray(o[n])&&o[n].length||typeof o[n]=="object"&&Object.keys(o[n]).length)){delete o[n];continue}const a=o[n];if(h[n]=a,o[n]||Array.isArray(o[n])&&o[n].length)switch(n){case"tag":case"thematic":case"discipline":case"type":r[n]={$containsAny:a};break;case"language":r[n]={$containsAny:a};break;case"issue":r.issue=a.length>1?{$in:a.map(d=>"content/issues/"+d+".md")}:"content/issues/"+a[0]+".md";break;case"years":const O=a.map(d=>+d);["articles","media"].includes(s)?r[n]={$in:O}:r[n]={$containsAny:O};break;default:r[n]=Array.isArray(a)?a[0]:a;break}}r.$or.length?r.$or=r.$or.flat():delete r.$or,console.log("pipeline: ",r);const f=await k(i).where(r).only("[]").find();console.log("count: ",f);const c=f.length;console.log("totalItems: ",c);const g=Math.ceil(c/this[s].itemsPerPage),m=c%this[s].itemsPerPage,l=this[s].itemsPerPage,A=()=>+this[s].page==1?0:+this[s].page===g?m===0?c-l:c-m:(+this[s].page-1)*l,b=this[s].view==="issues"?["issueIndex",this[s].sortDesc?1:-1,"date",this[s].sortDesc?1:-1]:[this[s].sortBy[0],this[s].sortDesc?-1:1],j=await k(i).where(r).sort({[b[0]]:b[1]}).skip(A()).limit(l).find(),I=this[s].views[Object.keys(this[s].views).find(n=>this[s].views[n].default===!0)],w=this[s].sort[Object.keys(this[s].sort).find(n=>{var a;return((a=this[s].sort[n])==null?void 0:a.default)===!0})],u={...this[s].search&&typeof this[s].search<"u"&&{search:this[s].search},...this[s].page>1&&{page:this[s].page.toString()},...((P=this[s].sortBy)==null?void 0:P.length)&&this[s].sortBy[0]!==w.value[0]&&{sortBy:this[s].sortBy[0]},...typeof this[s].sortDesc<"u"&&(this[s].sortDesc?"desc":"asc")!==w.value[1]&&{sortDesc:!!this[s].sortDesc},...this[s].view&&this[s].view!==I.name&&{view:this[s].view},...((S=Object.keys(o))==null?void 0:S.length)&&{filters:JSON.stringify(h)}};Object.keys(u).forEach(n=>u[n]===void 0?delete u[n]:typeof u[n]=="boolean"?u[n]===u[n].toString():{}),this.setFiltersCount(s),this.setBlankFilterLoad(s),console.log("type: ",s),this.setItems({items:j,total:c,numberOfPages:g,type:s}),this.setLoading(!1)}}});export{L as u};
